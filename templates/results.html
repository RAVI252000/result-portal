<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Results - MVGR College of Engineering</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="/static/result.css">
      </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="logo">
          <img src="/static/image.png" alt="MVGR Logo" />
        </div>
        <h1 class="college-name">MVGR</h1>
        <p class="college-subtitle">COLLEGE OF ENGINEERING</p>
      </div>

      <div class="student-info">
        <h2>Student Results</h2>
        <div class="info-row">
          <div class="info-item">
            <div class="info-label">Student Name</div>
            <div class="info-value" id="studentName">Loading...</div>
          </div>
          <div class="info-item">
            <div class="info-label">Roll Number</div>
            <div class="info-value" id="rollNumber">Loading...</div>
          </div>
          <div class="info-item">
            <div class="info-label">Semester</div>
            <div class="info-value" id="semester">Loading...</div>
          </div>
        </div>
      </div>

      <div class="results-table">
        <div class="table-header">
          <h3>Academic Results</h3>
          <p>Detailed Subject-wise Performance</p>
        </div>

        <div id="loadingDiv" class="loading">
          <p>Loading results...</p>
        </div>

        <div id="errorDiv" class="error" style="display: none">
          <p>
            Error loading results. Please make sure the Excel file is available.
          </p>
        </div>

        <div id="resultsContent" style="display: none">
          <table id="resultsTable">
            <thead>
              <tr>
                <th>Subject Code</th>
                <th>Subject Name</th>
                <th>Credits</th>
                <th>Grade</th>
              </tr>
            </thead>
            <tbody id="resultsBody"></tbody>
          </table>
        </div>
      </div>

      <div class="summary" id="summaryDiv" style="display: none">
        <div class="summary-item">
          <div class="summary-value" id="totalCredits">0</div>
          <div class="summary-label">Total Credits</div>
        </div>
        <div class="summary-item">
          <div class="summary-value" id="gpa">0.00</div>
          <div class="summary-label">GPA</div>
        </div>
        <div class="summary-item">
          <div class="summary-value" id="totalSubjects">0</div>
          <div class="summary-label">Total Subjects</div>
        </div>
      </div>

      <button class="back-btn" onclick="location.href='homepage.html'">
        ‚Üê Back to Home
      </button>
    </div>

    <script>
      // Sample data structure - replace this with actual Excel file reading
      const sampleData = {
        "21A91A0501": {
          name: "John Doe",
          semesters: {
            1: [
              {
                code: "MA101",
                subject: "Mathematics-I",
                credits: 4,
                grade: "A",
              },
              { code: "PH101", subject: "Physics", credits: 3, grade: "B" },
              { code: "CH101", subject: "Chemistry", credits: 3, grade: "F" },
              {
                code: "EE101",
                subject: "Basic Electrical",
                credits: 3,
                grade: "B",
              },
              {
                code: "CS101",
                subject: "Programming in C",
                credits: 4,
                grade: "A",
              },
              { code: "EN101", subject: "English", credits: 2, grade: "A" },
            ],
            2: [
              {
                code: "MA201",
                subject: "Mathematics-II",
                credits: 4,
                grade: "A",
              },
              { code: "PH201", subject: "Physics-II", credits: 3, grade: "B" },
              {
                code: "ME201",
                subject: "Engineering Mechanics",
                credits: 3,
                grade: "A",
              },
              {
                code: "CS201",
                subject: "Data Structures",
                credits: 4,
                grade: "A",
              },
              {
                code: "EC201",
                subject: "Digital Electronics",
                credits: 3,
                grade: "B",
              },
            ],
          },
        },
        "21A91A0502": {
          name: "Jane Smith",
          semesters: {
            1: [
              {
                code: "MA101",
                subject: "Mathematics-I",
                credits: 4,
                grade: "A",
              },
              { code: "PH101", subject: "Physics", credits: 3, grade: "A" },
              { code: "CH101", subject: "Chemistry", credits: 3, grade: "F" },
              {
                code: "EE101",
                subject: "Basic Electrical",
                credits: 3,
                grade: "A",
              },
              {
                code: "CS101",
                subject: "Programming in C",
                credits: 4,
                grade: "A",
              },
              { code: "EN101", subject: "English", credits: 2, grade: "A" },
            ],
          },
        },
      };

      // Grade point mapping
      const gradePoints = {
        A: 10,
        B: 8,
        C: 6,
        D: 4,
        F: 0,
      };

      function getUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        return {
          rollNumber: urlParams.get("roll") || "21A91A0501",
          semester: parseInt(urlParams.get("semester")) || 1,
        };
      }

      function getGradeClass(grade) {
        return `grade grade-${grade}`;
      }

      function calculateGPA(subjects) {
        let totalCredits = 0;
        let totalGradePoints = 0;

        subjects.forEach((subject) => {
          totalCredits += subject.credits;
          totalGradePoints += subject.credits * gradePoints[subject.grade];
        });

        return totalCredits > 0
          ? (totalGradePoints / totalCredits).toFixed(2)
          : 0.0;
      }

      function displayResults() {
        const params = getUrlParams();
        const studentData = sampleData[params.rollNumber];

        if (!studentData) {
          document.getElementById("errorDiv").style.display = "block";
          document.getElementById("loadingDiv").style.display = "none";
          return;
        }

        const semesterData = studentData.semesters[params.semester];
        if (!semesterData) {
          document.getElementById("errorDiv").style.display = "block";
          document.getElementById("loadingDiv").style.display = "none";
          return;
        }

        // Update student info
        document.getElementById("studentName").textContent = studentData.name;
        document.getElementById("rollNumber").textContent = params.rollNumber;
        document.getElementById(
          "semester"
        ).textContent = `Semester ${params.semester}`;

        // Populate results table
        const tbody = document.getElementById("resultsBody");
        tbody.innerHTML = "";

        semesterData.forEach((subject) => {
          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${subject.code}</td>
                    <td>${subject.subject}</td>
                    <td>${subject.credits}</td>
                    <td><span class="${getGradeClass(subject.grade)}">${
            subject.grade
          }</span></td>
                `;
        });

        // Calculate and display summary
        const totalCredits = semesterData.reduce(
          (sum, subject) => sum + subject.credits,
          0
        );
        const gpa = calculateGPA(semesterData);
        const totalSubjects = semesterData.length;

        document.getElementById("totalCredits").textContent = totalCredits;
        document.getElementById("gpa").textContent = gpa;
        document.getElementById("totalSubjects").textContent = totalSubjects;

        // Show results
        document.getElementById("loadingDiv").style.display = "none";
        document.getElementById("resultsContent").style.display = "block";
        document.getElementById("summaryDiv").style.display = "flex";
      }

      function goBack() {
        window.history.back();
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(displayResults, 1000); // Simulate loading time
      });

      // Function to read Excel file (for future implementation)
      function readExcelFile(file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: "array" });
          const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(firstSheet);

          // Process jsonData according to your Excel structure
          console.log(jsonData);
        };
        reader.readAsArrayBuffer(file);
      }
    </script>
  </body>
</html>
